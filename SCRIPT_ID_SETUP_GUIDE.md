# スクリプトプロジェクトID取得ガイド

## システム内のスプレッドシートの種類

このシステムでは、以下の3種類のスプレッドシートが使用されます：

### 1. マスタースプレッドシート
- **ID**: `1mhBpPhuL6Aq-YRXgmCu1kMtg0g3JO7h37pHdWmM8sqE`（CONFIG.MASTER_SPREADSHEET_ID）
- **用途**: 講師情報（Teachers）と提出状況（Submissions）を管理
- **スクリプトプロジェクトID**: **不要**（マスター側のコードは既にこのスプレッドシートに紐づいています）

### 2. テンプレートスプレッドシート
- **場所**: テンプレートフォルダ（`10_Templates`、ID: `1LRqvNMds307Hf7W2XO9M4PhcNtLiY1c5`）
- **ファイル名の例**: `2026-01_シフト提出テンプレ`、`2026-02_シフト提出テンプレ`
- **用途**: 講師用シートのコピー元
- **スクリプトプロジェクトID**: **基本的に不要**（テンプレートファイルにコードが含まれているため、コピー時に自動的にコピーされます）

### 3. 講師用シート（コピーされたシート）
- **場所**: 月フォルダ（例：`2026-01`フォルダ内）
- **ファイル名の例**: `2026-01_森永英敬_シフト提出`
- **用途**: 各講師がシフトを入力するシート
- **スクリプトプロジェクトID**: **これが必要です！**

## どのスプレッドシートのスクリプトプロジェクトIDが必要か？

**答え: コピーされた講師用シートのスクリプトプロジェクトID**

ただし、コピーされたシートは毎回新しいIDが生成されるため、事前に取得することはできません。

### 実用的なアプローチ

実際には、以下の2つのアプローチがあります：

#### アプローチ1: テンプレートファイルのスクリプトプロジェクトIDを使用（推奨）

テンプレートファイルのスクリプトプロジェクトIDを取得して、それをコピー先のスプレッドシートにも適用します。

**手順:**

1. **テンプレートスプレッドシートを開く**
   - Google Driveでテンプレートフォルダ（`10_Templates`）を開く
   - 月ごとのテンプレートファイル（例：`2026-01_シフト提出テンプレ`）を開く

2. **Apps Scriptエディタを開く**
   - スプレッドシートのメニューから「拡張機能」→「Apps Script」を選択
   - または、URLを直接開く: `https://script.google.com/home/projects`

3. **スクリプトプロジェクトIDを取得**
   - ブラウザのアドレスバーを確認
   - URLの形式: `https://script.google.com/home/projects/{SCRIPT_ID}/edit`
   - `{SCRIPT_ID}` の部分をコピー（例: `1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p`）

4. **スクリプトプロパティに保存**
   - マスター側のApps Scriptエディタを開く
   - 以下の関数を実行:
     ```javascript
     // テンプレートファイルのスクリプトプロジェクトIDを保存
     PropertiesService.getScriptProperties().setProperty('TEMPLATE_SCRIPT_ID', 'ここにスクリプトプロジェクトIDを貼り付け');
     ```

5. **コードを修正（オプション）**
   - `getScriptIdForSpreadsheet_()` 関数を修正して、テンプレートのスクリプトプロジェクトIDを使用するようにする
   - または、`copyTemplateSpreadsheet_()` 関数内で、テンプレートのスクリプトプロジェクトIDを取得して使用する

#### アプローチ2: コピー後にスクリプトプロジェクトIDを取得（実用的）

コピーされたシートのスクリプトプロジェクトIDを、コピー後に自動的に取得する方法です。

**手順:**

1. **コピーされたシートを開く**
   - Google Driveで月フォルダ（例：`2026-01`）を開く
   - コピーされた講師用シート（例：`2026-01_森永英敬_シフト提出`）を開く

2. **Apps Scriptエディタを開く**
   - スプレッドシートのメニューから「拡張機能」→「Apps Script」を選択

3. **スクリプトプロジェクトIDを取得**
   - ブラウザのアドレスバーを確認
   - URLの形式: `https://script.google.com/home/projects/{SCRIPT_ID}/edit`
   - `{SCRIPT_ID}` の部分をコピー

4. **スクリプトプロパティに保存**
   - マスター側のApps Scriptエディタを開く
   - 以下の関数を実行:
     ```javascript
     // コピーされたシートのスクリプトプロジェクトIDを保存
     saveScriptIdForSpreadsheet_('スプレッドシートID', 'スクリプトプロジェクトID');
     ```
   - 例:
     ```javascript
     saveScriptIdForSpreadsheet_('1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p', '1x2y3z4a5b6c7d8e9f0g1h2i3j4k5l6m');
     ```

## 詳細な手順（スクリーンショット付き説明）

### ステップ1: スプレッドシートを開く

1. Google Driveにアクセス
2. テンプレートフォルダまたは月フォルダを開く
3. 対象のスプレッドシートを開く

### ステップ2: Apps Scriptエディタを開く

**方法A: メニューから開く**
1. スプレッドシートの上部メニューから「拡張機能」をクリック
2. 「Apps Script」を選択

**方法B: URLから直接開く**
1. ブラウザのアドレスバーに以下を入力:
   ```
   https://script.google.com/home/projects
   ```
2. プロジェクト一覧から対象のスプレッドシートを選択

### ステップ3: スクリプトプロジェクトIDを取得

1. Apps Scriptエディタが開いたら、ブラウザのアドレスバーを確認
2. URLの形式を確認:
   ```
   https://script.google.com/home/projects/{SCRIPT_ID}/edit
   ```
3. `{SCRIPT_ID}` の部分をコピー
   - 例: URLが `https://script.google.com/home/projects/1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p/edit` の場合
   - スクリプトプロジェクトIDは: `1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p`

### ステップ4: スクリプトプロパティに保存（詳細手順）

このステップでは、取得したスクリプトプロジェクトIDを保存します。

#### 4-1. マスター側のApps Scriptエディタを開く

1. **マスタースプレッドシートを開く**
   - Google Driveを開く
   - マスタースプレッドシートを探す（ID: `1mhBpPhuL6Aq-YRXgmCu1kMtg0g3JO7h37pHdWmM8sqE`）
   - スプレッドシートを開く

2. **Apps Scriptエディタを開く**
   - スプレッドシートの上部メニューを確認
   - 「拡張機能」というメニューをクリック
   - ドロップダウンメニューから「Apps Script」を選択
   - 新しいタブでApps Scriptエディタが開きます

#### 4-2. コードを追加する

1. **新しい関数を作成**
   - Apps Scriptエディタが開いたら、左側にファイル一覧が表示されます
   - 既存のファイル（例：`Code.gs`、`drive.js`など）が表示されているはずです
   - 新しい関数を追加するために、既存のファイル（例：`drive.js`）を開くか、新しいファイルを作成します

2. **コードを追加**
   - エディタの下部に、以下のコードを追加します：
     ```javascript
     /**
      * スクリプトプロジェクトIDを保存する関数（一時的な実行用）
      */
     function saveScriptIdForTemplate() {
       // テンプレートファイルのスプレッドシートIDとスクリプトプロジェクトIDを指定
       // ステップ2で取得したスクリプトプロジェクトIDをここに貼り付けます
       const templateSpreadsheetId = '1uVWYwQkr4zQ5UMwGCNL7nNkUvRwLA5v-IK2NlO1Ulyk'; // テンプレートファイルのスプレッドシートID
       const scriptProjectId = 'ここにステップ2で取得したスクリプトプロジェクトIDを貼り付け'; // 例: '1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p'
       
       // 保存を実行
       saveScriptIdForSpreadsheet_(templateSpreadsheetId, scriptProjectId);
       
       // 結果をログに出力
       Logger.log('スクリプトプロジェクトIDを保存しました:');
       Logger.log('スプレッドシートID: ' + templateSpreadsheetId);
       Logger.log('スクリプトプロジェクトID: ' + scriptProjectId);
     }
     ```

3. **スクリプトプロジェクトIDを貼り付け**
   - ステップ2で取得したスクリプトプロジェクトIDをコピー
   - コード内の `'ここにステップ2で取得したスクリプトプロジェクトIDを貼り付け'` の部分を、実際のスクリプトプロジェクトIDに置き換えます
   - 例: `const scriptProjectId = '1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p';`

4. **保存**
   - エディタ上部の「保存」ボタン（💾）をクリック
   - または、キーボードショートカット: `Ctrl+S`（Windows）または `Cmd+S`（Mac）

#### 4-3. 関数を実行する

1. **関数を選択**
   - エディタ上部の「関数を選択」ドロップダウンをクリック
   - ドロップダウンから `saveScriptIdForTemplate` を選択

2. **実行ボタンをクリック**
   - エディタ上部の「実行」ボタン（▶️）をクリック
   - または、キーボードショートカット: `Ctrl+Enter`（Windows）または `Cmd+Enter`（Mac）

3. **認証（初回のみ）**
   - 初回実行時は、認証が求められる場合があります
   - 「承認が必要です」というダイアログが表示されたら、「権限を確認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「（プロジェクト名）に移動（安全ではないページ）」をクリック
   - 「許可」をクリック

4. **実行ログを確認**
   - エディタ下部の「実行ログ」タブをクリック
   - 以下のようなメッセージが表示されれば成功：
     ```
     スクリプトプロジェクトIDを保存しました:
     スプレッドシートID: 1uVWYwQkr4zQ5UMwGCNL7nNkUvRwLA5v-IK2NlO1Ulyk
     スクリプトプロジェクトID: 1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p
     ```

#### 4-4. 確認（オプション）

1. **スクリプトプロパティを確認**
   - エディタ左側のメニューから「プロジェクトの設定」（⚙️ アイコン）をクリック
   - 下にスクロールして「スクリプト プロパティ」セクションを表示
   - `SCRIPT_ID_1uVWYwQkr4zQ5UMwGCNL7nNkUvRwLA5v-IK2NlO1Ulyk` というプロパティが表示されていれば成功

#### 4-5. 一時的な関数を削除（オプション）

保存が完了したら、一時的に追加した `saveScriptIdForTemplate` 関数は削除しても構いません。

1. エディタで `saveScriptIdForTemplate` 関数を選択
2. 削除（`Delete` キーまたは `Backspace` キー）
3. 保存（`Ctrl+S` または `Cmd+S`）

## よくある質問

### Q1: どのスプレッドシートのスクリプトプロジェクトIDが必要ですか？

**A:** コピーされた講師用シートのスクリプトプロジェクトIDが必要です。ただし、コピーされたシートは毎回新しいIDが生成されるため、実用的にはテンプレートファイルのスクリプトプロジェクトIDを取得して使用することを推奨します。

### Q2: テンプレートファイルのスクリプトプロジェクトIDで大丈夫ですか？

**A:** はい、大丈夫です。テンプレートファイルのスクリプトプロジェクトIDを取得して、それをコピー先のスプレッドシートにも適用することができます。

### Q3: コピーされたシートごとにスクリプトプロジェクトIDを取得する必要がありますか？

**A:** いいえ、必要ありません。テンプレートファイルのスクリプトプロジェクトIDを1つ取得すれば、それをすべてのコピー先に適用できます。

### Q4: スクリプトプロジェクトIDが見つかりません

**A:** 以下の点を確認してください：
1. スプレッドシートが正しく開けているか
2. 「拡張機能」→「Apps Script」からApps Scriptエディタが開けているか
3. ブラウザのアドレスバーに正しいURLが表示されているか
4. スプレッドシートにスクリプトが紐づいているか（初めて開く場合は、スクリプトが存在しない可能性があります）

### Q5: スクリプトプロジェクトIDを取得する必要はありますか？

**A:** 必須ではありません。スクリプトプロジェクトIDが取得できない場合でも、システムは正常に動作します（テンプレートファイルにコードが含まれているため、コピー時に自動的にコードもコピーされます）。ただし、コード展開機能を使用する場合は、スクリプトプロジェクトIDが必要です。

## 実際の使用例

### 例1: テンプレートファイルのスクリプトプロジェクトIDを取得

1. **テンプレートファイルを開く**
   - Google Driveで `10_Templates` フォルダを開く
   - `2026-01_シフト提出テンプレ` というファイルを開く
   - スプレッドシートIDを確認（URLから）: 例: `1uVWYwQkr4zQ5UMwGCNL7nNkUvRwLA5v-IK2NlO1Ulyk`

2. **Apps Scriptエディタを開く**
   - 「拡張機能」→「Apps Script」を選択
   - URLが `https://script.google.com/home/projects/1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p/edit` の場合
   - スクリプトプロジェクトIDは: `1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p`

3. **保存**
   ```javascript
   // マスター側のApps Scriptエディタで実行
   saveScriptIdForSpreadsheet_(
     '1uVWYwQkr4zQ5UMwGCNL7nNkUvRwLA5v-IK2NlO1Ulyk',  // テンプレートファイルのスプレッドシートID
     '1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p'              // スクリプトプロジェクトID
   );
   ```

### 例2: コピーされた講師用シートのスクリプトプロジェクトIDを取得

1. **コピーされたシートを開く**
   - Google Driveで `2026-01` フォルダを開く
   - `2026-01_森永英敬_シフト提出` というファイルを開く
   - スプレッドシートIDを確認（URLから）: 例: `1x2y3z4a5b6c7d8e9f0g1h2i3j4k5l6m`

2. **Apps Scriptエディタを開く**
   - 「拡張機能」→「Apps Script」を選択
   - URLが `https://script.google.com/home/projects/9z8y7x6w5v4u3t2s1r0q9p8o7n6m5l4k/edit` の場合
   - スクリプトプロジェクトIDは: `9z8y7x6w5v4u3t2s1r0q9p8o7n6m5l4k`

3. **保存**
   ```javascript
   // マスター側のApps Scriptエディタで実行
   saveScriptIdForSpreadsheet_(
     '1x2y3z4a5b6c7d8e9f0g1h2i3j4k5l6m',              // コピーされたシートのスプレッドシートID
     '9z8y7x6w5v4u3t2s1r0q9p8o7n6m5l4k'              // スクリプトプロジェクトID
   );
   ```

## システムの動作フロー

### 通常の動作（スクリプトプロジェクトIDなし）

1. フォーム送信 → `onFormSubmit()` が実行される
2. テンプレートファイルをコピー → `copyTemplateSpreadsheet_()` が実行される
3. コピー時に、テンプレートファイルに含まれるコードも自動的にコピーされる
4. 講師用シートが作成される（コードも含まれる）

### コード展開機能を使用する場合（スクリプトプロジェクトIDあり）

1. フォーム送信 → `onFormSubmit()` が実行される
2. テンプレートファイルをコピー → `copyTemplateSpreadsheet_()` が実行される
3. コピー後に、`deployTemplateSideCodeToSpreadsheet_()` が自動的に実行される
4. スクリプトプロパティからスクリプトプロジェクトIDを取得
5. Apps Script APIを使用して、最新のコードを展開
6. 講師用シートが作成される（最新のコードが展開される）

## まとめ

- **必要なスクリプトプロジェクトID**: コピーされた講師用シート（またはテンプレートファイル）
- **取得方法**: スプレッドシートを開く → 「拡張機能」→「Apps Script」→ URLからスクリプトプロジェクトIDをコピー
- **保存方法**: `saveScriptIdForSpreadsheet_(spreadsheetId, scriptId)` を実行
- **注意**: 必須ではありませんが、コード展開機能を使用する場合は必要です
- **推奨**: テンプレートファイルのスクリプトプロジェクトIDを1つ取得すれば、すべてのコピー先に適用できます

